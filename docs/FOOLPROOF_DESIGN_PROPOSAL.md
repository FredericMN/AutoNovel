# AutoNovel é˜²å‘†è®¾è®¡ä¼˜åŒ–æ–¹æ¡ˆ

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–¹æ¡ˆé’ˆå¯¹ç”¨æˆ·æå‡ºçš„ä¸‰ä¸ªé˜²å‘†åœºæ™¯è¿›è¡Œè¯¦ç»†è®¾è®¡ï¼Œç¡®ä¿ç³»ç»Ÿåœ¨éæ­£å¸¸æ“ä½œä¸‹èƒ½å¤Ÿæå‰å‘ç°é—®é¢˜å¹¶ç»™å‡ºæ˜ç¡®æç¤ºã€‚

---

## ğŸ¯ åœºæ™¯ä¸€ï¼šç« èŠ‚è¿ç»­æ€§æ ¡éªŒ

### é—®é¢˜æè¿°
- **åœºæ™¯1.1**: æ²¡æœ‰ç”Ÿæˆä»»ä½•ç« èŠ‚æ—¶ï¼Œè®¾ç½®ç« èŠ‚å·ä¸ä¸º1
- **åœºæ™¯1.2**: ç¬¬3ç« è¿˜æ²¡ç”Ÿæˆï¼Œä½†ç« èŠ‚å·é€‰æ‹©ç¬¬5ç« 

### é£é™©åˆ†æ
- å¯èƒ½å¯¼è‡´ç« èŠ‚ç¼ºå¤±ï¼Œç ´åå°è¯´è¿ç»­æ€§
- å‘é‡åº“æ£€ç´¢å¯èƒ½æ‰¾ä¸åˆ°å‰ç½®ç« èŠ‚ä¸Šä¸‹æ–‡
- å…¨å±€æ‘˜è¦å’Œè§’è‰²çŠ¶æ€æ›´æ–°å¼‚å¸¸

### ä¼˜åŒ–æ–¹æ¡ˆ

#### æ–¹æ¡ˆAï¼šæ™ºèƒ½æ£€æµ‹ + æç¤ºï¼ˆæ¨èï¼‰

**å®ç°ä½ç½®**: `ui/generation_handlers.py` - `generate_chapter_draft_ui()`

**æ ¡éªŒé€»è¾‘**:
```python
def validate_chapter_continuity(filepath: str, chapter_num: int) -> dict:
    """
    æ ¡éªŒç« èŠ‚è¿ç»­æ€§

    Returns:
        {
            "valid": bool,           # æ˜¯å¦é€šè¿‡æ ¡éªŒ
            "error_type": str,       # é”™è¯¯ç±»å‹
            "message": str,          # é”™è¯¯æç¤º
            "suggestion": str,       # å»ºè®®æ“ä½œ
            "missing_chapters": list # ç¼ºå¤±çš„ç« èŠ‚å·åˆ—è¡¨
        }
    """
    chapters_dir = os.path.join(filepath, "chapters")

    # æ£€æŸ¥æ˜¯å¦å­˜åœ¨ç« èŠ‚ç›®å½•
    if not os.path.exists(chapters_dir):
        if chapter_num != 1:
            return {
                "valid": False,
                "error_type": "no_chapters_exist",
                "message": f"âš ï¸ ç« èŠ‚è¿ç»­æ€§æ£€æŸ¥å¤±è´¥",
                "suggestion": f"å½“å‰æ²¡æœ‰ä»»ä½•ç« èŠ‚ï¼Œä½†æ‚¨è®¾ç½®çš„ç« èŠ‚å·ä¸º {chapter_num}ã€‚\nå»ºè®®å…ˆç”Ÿæˆç¬¬1ç« ã€‚",
                "missing_chapters": list(range(1, chapter_num))
            }
        return {"valid": True}

    # æ£€æŸ¥å·²ç”Ÿæˆçš„ç« èŠ‚
    existing_chapters = []
    for i in range(1, chapter_num):
        chapter_file = os.path.join(chapters_dir, f"chapter_{i}.txt")
        if os.path.exists(chapter_file):
            existing_chapters.append(i)

    # æŸ¥æ‰¾ç¼ºå¤±ç« èŠ‚
    missing_chapters = []
    for i in range(1, chapter_num):
        if i not in existing_chapters:
            missing_chapters.append(i)

    if missing_chapters:
        return {
            "valid": False,
            "error_type": "missing_chapters",
            "message": f"âš ï¸ æ£€æµ‹åˆ°ç« èŠ‚ç¼ºå¤±",
            "suggestion": f"è¦ç”Ÿæˆç¬¬ {chapter_num} ç« ï¼Œéœ€è¦å…ˆå®Œæˆä»¥ä¸‹ç« èŠ‚ï¼š\n{', '.join(map(str, missing_chapters[:5]))}{'...' if len(missing_chapters) > 5 else ''}",
            "missing_chapters": missing_chapters
        }

    return {"valid": True}
```

**ç”¨æˆ·ä½“éªŒ**:
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  âš ï¸  ç« èŠ‚è¿ç»­æ€§æ£€æŸ¥å¤±è´¥                     â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  å½“å‰è¦ç”Ÿæˆï¼šç¬¬ 5 ç«                         â•‘
â•‘  å·²ç”Ÿæˆç« èŠ‚ï¼š1, 2                           â•‘
â•‘  ç¼ºå¤±ç« èŠ‚ï¼š3, 4                             â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  å»ºè®®æ“ä½œï¼š                                 â•‘
â•‘  1. å…ˆç”Ÿæˆç¬¬ 3 ç«                            â•‘
â•‘  2. æˆ–è€…ä¿®æ”¹ç« èŠ‚å·ä¸º 3                      â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  [ å¼ºåˆ¶ç”Ÿæˆ ]  [ è¿”å›ä¿®æ”¹ ]                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

**å®ç°ç»†èŠ‚**:
1. åœ¨ç”Ÿæˆç« èŠ‚å‰è°ƒç”¨æ ¡éªŒå‡½æ•°
2. å¦‚æœæ ¡éªŒå¤±è´¥ï¼Œå¼¹å‡ºå¯¹è¯æ¡†æç¤º
3. æä¾›ä¸¤ä¸ªé€‰é¡¹ï¼š
   - **å¼ºåˆ¶ç”Ÿæˆ**ï¼šå…è®¸è·³ç« èŠ‚ç”Ÿæˆï¼ˆç”¨äºç‰¹æ®Šåœºæ™¯ï¼‰
   - **è¿”å›ä¿®æ”¹**ï¼šå…³é—­å¯¹è¯æ¡†ï¼Œè¿”å›ä¿®æ”¹ç« èŠ‚å·

#### æ–¹æ¡ˆBï¼šè‡ªåŠ¨ä¿®æ­£ç« èŠ‚å·ï¼ˆå¯é€‰ï¼‰

åœ¨å°è¯´å‚æ•°åŒºåŸŸå¢åŠ "æ™ºèƒ½ç« èŠ‚å·"åŠŸèƒ½ï¼š

```python
def auto_detect_next_chapter(filepath: str) -> int:
    """è‡ªåŠ¨æ£€æµ‹ä¸‹ä¸€ä¸ªåº”è¯¥ç”Ÿæˆçš„ç« èŠ‚å·"""
    chapters_dir = os.path.join(filepath, "chapters")
    if not os.path.exists(chapters_dir):
        return 1

    # æ‰¾åˆ°æœ€å¤§çš„è¿ç»­ç« èŠ‚å·
    chapter_num = 1
    while True:
        chapter_file = os.path.join(chapters_dir, f"chapter_{chapter_num}.txt")
        if not os.path.exists(chapter_file):
            break
        chapter_num += 1

    return chapter_num
```

**UIå¢å¼º**: åœ¨ç« èŠ‚å·è¾“å…¥æ¡†æ—è¾¹æ·»åŠ "ğŸ”„ è‡ªåŠ¨æ£€æµ‹"æŒ‰é’®

---

## ğŸ¯ åœºæ™¯äºŒï¼šé…ç½®ä¸€è‡´æ€§æ ¡éªŒ

### é—®é¢˜æè¿°
ç”Ÿæˆæ¶æ„å’Œç›®å½•åï¼Œä¿®æ”¹äº†ç« èŠ‚æ•°æˆ–åˆ†å·æ•°

### é£é™©åˆ†æè¯¦è§£

#### 2.1 ç« èŠ‚æ•°å˜åŒ–çš„å½±å“

**åœºæ™¯**: åŸæœ¬è®¾ç½®30ç« ï¼Œç”Ÿæˆæ¶æ„å’Œç›®å½•åæ”¹ä¸º20ç« 

**å½±å“èŒƒå›´**:

| å—å½±å“æ¨¡å— | å…·ä½“å½±å“ | ä¸¥é‡ç¨‹åº¦ |
|-----------|---------|---------|
| `Novel_directory.txt` | ç›®å½•ä¸­æœ‰30ç« çš„æ ‡é¢˜å’Œå¤§çº²ï¼Œä½†åªä¼šç”Ÿæˆ20ç«  | âš ï¸ ä¸­ç­‰ |
| å‘é‡åº“å…ƒæ•°æ® | `chapter_metadata` å­—æ®µè®°å½•çš„æ€»ç« èŠ‚æ•°ä¸ä¸€è‡´ | âš ï¸ ä¸­ç­‰ |
| å…¨å±€æ‘˜è¦ç”Ÿæˆ | å¯èƒ½å¼•ç”¨ä¸å­˜åœ¨çš„ç« èŠ‚ä¿¡æ¯ | âš ï¸ ä¸­ç­‰ |
| åˆ†å·é€»è¾‘ | åˆ†å·è¾¹ç•Œè®¡ç®—é”™è¯¯ | ğŸ”´ ä¸¥é‡ |

**ç¤ºä¾‹é—®é¢˜**:
```python
# åŸé…ç½®: 30ç« , 3å· â†’ æ¯å·10ç« 
# æ–°é…ç½®: 20ç« , 3å· â†’ æ¯å·6.67ç« ï¼ˆè®¡ç®—é”™è¯¯ï¼‰

# volume_utils.calculate_volume_ranges(20, 3)
# è¿”å›: [(1, 7), (8, 14), (15, 20)]  # åˆ†é…ä¸å‡

# ä½† Novel_directory.txt ä¸­ä»ç„¶æ ‡è®°:
# ç¬¬1-10ç« ä¸ºç¬¬1å·
# ç¬¬11-20ç« ä¸ºç¬¬2å·
# ç¬¬21-30ç« ä¸ºç¬¬3å·ï¼ˆä¸å­˜åœ¨ï¼‰
```

#### 2.2 åˆ†å·æ•°å˜åŒ–çš„å½±å“

**åœºæ™¯**: åŸæœ¬è®¾ç½®3å·ï¼Œç”Ÿæˆæ¶æ„å’Œç›®å½•åæ”¹ä¸º2å·

**å½±å“èŒƒå›´**:

| å—å½±å“æ¨¡å— | å…·ä½“å½±å“ | ä¸¥é‡ç¨‹åº¦ |
|-----------|---------|---------|
| `Volume_architecture.txt` | æ–‡ä»¶ä¸­æœ‰3å·çš„æ¶æ„ï¼Œä½†ç³»ç»Ÿåªè¯†åˆ«2å· | ğŸ”´ ä¸¥é‡ |
| åˆ†å·è“å›¾ | `Novel_directory.txt` ä¸­ç« èŠ‚çš„å·å·æ ‡è®°é”™è¯¯ | ğŸ”´ ä¸¥é‡ |
| å‘é‡æ£€ç´¢ | `volume_number` å…ƒæ•°æ®ä¸åŒ¹é…ï¼Œæ£€ç´¢å¤±è´¥ | ğŸ”´ ä¸¥é‡ |
| å·æ‘˜è¦ç”Ÿæˆ | `volume_X_summary.txt` æ–‡ä»¶æ··ä¹± | ğŸ”´ ä¸¥é‡ |

**ç¤ºä¾‹é—®é¢˜**:
```python
# åŸé…ç½®: 30ç« , 3å·
# Volume_architecture.txt åŒ…å«:
# - ç¬¬1å· (1-10ç« )
# - ç¬¬2å· (11-20ç« )
# - ç¬¬3å· (21-30ç« )

# æ–°é…ç½®: 30ç« , 2å·
# ç³»ç»Ÿè®¡ç®—: æ¯å·15ç« 
# - ç¬¬1å· (1-15ç« )  â† ä¸åŸæ¶æ„ä¸ç¬¦
# - ç¬¬2å· (16-30ç« ) â† ä¸åŸæ¶æ„ä¸ç¬¦

# ç« èŠ‚ç”Ÿæˆæ—¶:
# - ç¬¬11ç« ä»¥ä¸ºè‡ªå·±å±äºç¬¬2å·ï¼ˆæ–°é€»è¾‘ï¼‰
# - ä½† Volume_architecture.txt æ ‡è®°ä¸ºç¬¬2å·ï¼ˆæ—§é€»è¾‘ï¼‰
# - extract_volume_architecture(11) â†’ æå–ç¬¬2å·æ¶æ„ âŒ
```

### ä¼˜åŒ–æ–¹æ¡ˆ

#### æ–¹æ¡ˆAï¼šé…ç½®é”å®šæœºåˆ¶ï¼ˆæ¨èï¼‰

**å®ç°ä½ç½®**: `ui/novel_params_tab.py` + `ui/main_window.py`

**æ ¸å¿ƒé€»è¾‘**:

```python
def check_critical_files_exist(filepath: str) -> dict:
    """
    æ£€æŸ¥å…³é”®æ–‡ä»¶æ˜¯å¦å­˜åœ¨

    Returns:
        {
            "architecture_exists": bool,
            "directory_exists": bool,
            "volume_architecture_exists": bool,
            "any_chapter_exists": bool,
            "is_locked": bool  # æ˜¯å¦åº”é”å®šé…ç½®
        }
    """
    result = {
        "architecture_exists": os.path.exists(os.path.join(filepath, "Novel_architecture.txt")),
        "directory_exists": os.path.exists(os.path.join(filepath, "Novel_directory.txt")),
        "volume_architecture_exists": os.path.exists(os.path.join(filepath, "Volume_architecture.txt")),
        "any_chapter_exists": False
    }

    # æ£€æŸ¥æ˜¯å¦æœ‰ä»»ä½•ç« èŠ‚ç”Ÿæˆ
    chapters_dir = os.path.join(filepath, "chapters")
    if os.path.exists(chapters_dir):
        for f in os.listdir(chapters_dir):
            if f.startswith("chapter_") and f.endswith(".txt"):
                result["any_chapter_exists"] = True
                break

    # åˆ¤æ–­æ˜¯å¦åº”é”å®š
    result["is_locked"] = result["directory_exists"] or result["any_chapter_exists"]

    return result
```

**UIå¢å¼º**:

1. **é…ç½®é¡¹é¢œè‰²å˜åŒ–**:
   - æœªé”å®šï¼šæ­£å¸¸é¢œè‰²ï¼ˆç™½åº•é»‘å­—ï¼‰
   - å·²é”å®šï¼šç¦ç”¨é¢œè‰²ï¼ˆç°åº•ç°å­—ï¼‰

2. **é”å®šå›¾æ ‡**:
   ```
   ç« èŠ‚æ•°: [  30  ] ğŸ”’  â† å·²é”å®š
   åˆ†å·æ•°: [  3   ] ğŸ”’  â† å·²é”å®š
   ```

3. **æ‚¬åœæç¤º**:
   ```
   é¼ æ ‡æ‚¬åœåœ¨é”å®šå­—æ®µä¸Šæ—¶æ˜¾ç¤ºï¼š

   ğŸ”’ æ­¤å‚æ•°å·²é”å®š

   åŸå› ï¼šå·²ç”Ÿæˆç« èŠ‚ç›®å½•

   å¦‚éœ€ä¿®æ”¹ï¼Œè¯·ï¼š
   1. é‡æ–°ç”Ÿæˆæ¶æ„å’Œç›®å½•
   2. æˆ–åˆ é™¤ç°æœ‰ç›®å½•æ–‡ä»¶
   ```

4. **å¼ºåˆ¶ä¿®æ”¹æŒ‰é’®**ï¼ˆç®¡ç†å‘˜æ¨¡å¼ï¼‰:

```python
# åœ¨å°è¯´å‚æ•°åŒºåŸŸåº•éƒ¨æ·»åŠ 
unlock_config_btn = ctk.CTkButton(
    self.params_frame,
    text="ğŸ”“ è§£é”é…ç½®ï¼ˆé«˜çº§ï¼‰",
    command=self.unlock_critical_config,
    font=("Microsoft YaHei", 10),
    fg_color="#FF6347",  # çº¢è‰²è­¦å‘Š
    height=24
)
```

**è§£é”å¯¹è¯æ¡†**:
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  âš ï¸  è­¦å‘Šï¼šä¿®æ”¹å…³é”®é…ç½®                     â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  ä¿®æ”¹ç« èŠ‚æ•°æˆ–åˆ†å·æ•°å¯èƒ½å¯¼è‡´ï¼š               â•‘
â•‘                                            â•‘
â•‘  âŒ ç« èŠ‚ç›®å½•ä¸å®é™…ä¸ç¬¦                      â•‘
â•‘  âŒ åˆ†å·æ¶æ„é”™ä¹±                            â•‘
â•‘  âŒ å‘é‡åº“å…ƒæ•°æ®ä¸ä¸€è‡´                      â•‘
â•‘  âŒ å·²ç”Ÿæˆç« èŠ‚æ— æ³•æ­£ç¡®å¼•ç”¨                  â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  å»ºè®®æ“ä½œï¼š                                 â•‘
â•‘  1. åˆ é™¤ Novel_directory.txt               â•‘
â•‘  2. åˆ é™¤ Volume_architecture.txt           â•‘
â•‘  3. é‡æ–°ç”Ÿæˆæ¶æ„å’Œç›®å½•                      â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  ç¡®å®šè¦è§£é”å—ï¼Ÿ                             â•‘
â•‘  [ æˆ‘æ˜ç™½é£é™©ï¼Œç»§ç»­ ]  [ å–æ¶ˆ ]            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

#### æ–¹æ¡ˆBï¼šé…ç½®å˜æ›´æ£€æµ‹ï¼ˆè¾…åŠ©ï¼‰

åœ¨ä¿å­˜é…ç½®æ—¶å¢åŠ å˜æ›´æ£€æµ‹ï¼š

```python
def validate_config_changes(old_config: dict, new_config: dict, filepath: str) -> dict:
    """
    æ£€æµ‹å…³é”®é…ç½®å˜æ›´

    Returns:
        {
            "has_critical_changes": bool,
            "changes": list,  # å˜æ›´é¡¹åˆ—è¡¨
            "warnings": list  # è­¦å‘Šä¿¡æ¯
        }
    """
    result = {
        "has_critical_changes": False,
        "changes": [],
        "warnings": []
    }

    # æ£€æŸ¥ç« èŠ‚æ•°å˜æ›´
    old_chapters = old_config.get("other_params", {}).get("num_chapters", 0)
    new_chapters = new_config.get("other_params", {}).get("num_chapters", 0)

    if old_chapters != new_chapters:
        result["has_critical_changes"] = True
        result["changes"].append(f"ç« èŠ‚æ•°: {old_chapters} â†’ {new_chapters}")

        # æ£€æŸ¥æ˜¯å¦å·²æœ‰ç›®å½•
        if os.path.exists(os.path.join(filepath, "Novel_directory.txt")):
            result["warnings"].append(
                "å·²å­˜åœ¨ç« èŠ‚ç›®å½•æ–‡ä»¶ï¼Œä¿®æ”¹ç« èŠ‚æ•°å¯èƒ½å¯¼è‡´ç›®å½•ä¸å®é™…ä¸ç¬¦ã€‚\n"
                "å»ºè®®åˆ é™¤ Novel_directory.txt å¹¶é‡æ–°ç”Ÿæˆã€‚"
            )

    # æ£€æŸ¥åˆ†å·æ•°å˜æ›´
    old_volumes = old_config.get("other_params", {}).get("num_volumes", 0)
    new_volumes = new_config.get("other_params", {}).get("num_volumes", 0)

    if old_volumes != new_volumes:
        result["has_critical_changes"] = True
        result["changes"].append(f"åˆ†å·æ•°: {old_volumes} â†’ {new_volumes}")

        # æ£€æŸ¥æ˜¯å¦å·²æœ‰åˆ†å·æ¶æ„
        if os.path.exists(os.path.join(filepath, "Volume_architecture.txt")):
            result["warnings"].append(
                "å·²å­˜åœ¨åˆ†å·æ¶æ„æ–‡ä»¶ï¼Œä¿®æ”¹åˆ†å·æ•°ä¼šå¯¼è‡´å·å·è®¡ç®—é”™è¯¯ã€‚\n"
                "å»ºè®®åˆ é™¤ Volume_architecture.txt å¹¶é‡æ–°ç”Ÿæˆã€‚"
            )

    return result
```

**ä¿å­˜ç¡®è®¤å¯¹è¯æ¡†**:
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  âš ï¸  æ£€æµ‹åˆ°å…³é”®é…ç½®å˜æ›´                     â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  å˜æ›´å†…å®¹ï¼š                                 â•‘
â•‘  â€¢ ç« èŠ‚æ•°: 30 â†’ 20                         â•‘
â•‘  â€¢ åˆ†å·æ•°: 3 â†’ 2                           â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  âš ï¸  è­¦å‘Šï¼š                                 â•‘
â•‘  â€¢ å·²å­˜åœ¨ç« èŠ‚ç›®å½•æ–‡ä»¶ï¼Œä¿®æ”¹å¯èƒ½å¯¼è‡´ä¸ä¸€è‡´   â•‘
â•‘  â€¢ å·²å­˜åœ¨åˆ†å·æ¶æ„æ–‡ä»¶ï¼Œéœ€è¦é‡æ–°ç”Ÿæˆ         â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  [ ç»§ç»­ä¿å­˜ ]  [ å–æ¶ˆ ]                    â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## ğŸ¯ åœºæ™¯ä¸‰ï¼šä¿å­˜çŠ¶æ€å¯è§†åŒ–æç¤º

### é—®é¢˜æè¿°
ç¼–è¾‘å®Œå°è¯´å‚æ•°åä¸ç‚¹ä¿å­˜ï¼Œä½†é…ç½®å®é™…æœªç”Ÿæ•ˆ

### ä¼˜åŒ–æ–¹æ¡ˆ

#### æ–¹æ¡ˆAï¼šå®æ—¶ä¿å­˜çŠ¶æ€æŒ‡ç¤ºå™¨ï¼ˆæ¨èï¼‰

**å®ç°ä½ç½®**: `ui/novel_params_tab.py`

**UIå¸ƒå±€**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å°è¯´å‚æ•°                    ğŸŸ¢ å·²ä¿å­˜   â”‚  â† çŠ¶æ€æŒ‡ç¤ºå™¨
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ä¸»é¢˜(Topic):                             â”‚
â”‚ [___________________________________]   â”‚
â”‚                                         â”‚
â”‚ ç±»å‹(Genre):                            â”‚
â”‚ [___________________________________]   â”‚
â”‚                                         â”‚
â”‚ ...                                     â”‚
â”‚                                         â”‚
â”‚ [ ğŸ’¾ ä¿å­˜å°è¯´å‚æ•° ]                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**çŠ¶æ€æŒ‡ç¤ºå™¨è®¾è®¡**:

| çŠ¶æ€ | é¢œè‰² | å›¾æ ‡ | æ–‡å­— | è¯´æ˜ |
|-----|------|------|------|------|
| å·²ä¿å­˜ | ğŸŸ¢ ç»¿è‰² | âœ“ | å·²ä¿å­˜ | å½“å‰å‚æ•°å·²ä¿å­˜åˆ° config.json |
| æœªä¿å­˜ | ğŸ”´ çº¢è‰² | âš  | å°šæœªä¿å­˜ | æœ‰å‚æ•°ä¿®æ”¹ä½†æœªç‚¹å‡»ä¿å­˜ |
| ä¿å­˜ä¸­ | ğŸŸ¡ é»„è‰² | âŸ³ | ä¿å­˜ä¸­... | æ­£åœ¨æ‰§è¡Œä¿å­˜æ“ä½œ |

**å®ç°ä»£ç **:

```python
class SaveStatusIndicator:
    """ä¿å­˜çŠ¶æ€æŒ‡ç¤ºå™¨"""

    def __init__(self, parent_frame):
        self.frame = ctk.CTkFrame(parent_frame)

        # çŠ¶æ€å›¾æ ‡
        self.status_icon = ctk.CTkLabel(
            self.frame,
            text="ğŸŸ¢",
            font=("Microsoft YaHei", 16)
        )
        self.status_icon.grid(row=0, column=0, padx=3)

        # çŠ¶æ€æ–‡å­—
        self.status_text = ctk.CTkLabel(
            self.frame,
            text="å·²ä¿å­˜",
            font=("Microsoft YaHei", 11),
            text_color="#00AA00"  # ç»¿è‰²
        )
        self.status_text.grid(row=0, column=1, padx=3)

        # æœ€åä¿å­˜æ—¶é—´
        self.time_label = ctk.CTkLabel(
            self.frame,
            text="",
            font=("Microsoft YaHei", 9),
            text_color="gray"
        )
        self.time_label.grid(row=0, column=2, padx=5)

    def set_saved(self):
        """è®¾ç½®ä¸ºå·²ä¿å­˜çŠ¶æ€"""
        self.status_icon.configure(text="ğŸŸ¢")
        self.status_text.configure(
            text="å·²ä¿å­˜",
            text_color="#00AA00"
        )
        from datetime import datetime
        self.time_label.configure(
            text=f"ä¿å­˜äº {datetime.now().strftime('%H:%M:%S')}"
        )

    def set_unsaved(self):
        """è®¾ç½®ä¸ºæœªä¿å­˜çŠ¶æ€"""
        self.status_icon.configure(text="ğŸ”´")
        self.status_text.configure(
            text="å°šæœªä¿å­˜",
            text_color="#FF0000"
        )
        self.time_label.configure(text="æœ‰æœªä¿å­˜çš„ä¿®æ”¹")

    def set_saving(self):
        """è®¾ç½®ä¸ºä¿å­˜ä¸­çŠ¶æ€"""
        self.status_icon.configure(text="ğŸŸ¡")
        self.status_text.configure(
            text="ä¿å­˜ä¸­...",
            text_color="#FFA500"
        )
        self.time_label.configure(text="")
```

**å˜æ›´ç›‘å¬**:

```python
def setup_change_listeners(self):
    """ä¸ºæ‰€æœ‰è¾“å…¥ç»„ä»¶æ·»åŠ å˜æ›´ç›‘å¬å™¨"""

    # æ–‡æœ¬æ¡†ç›‘å¬ï¼ˆTopic, User Guidanceç­‰ï¼‰
    def on_text_change(event=None):
        self.save_status_indicator.set_unsaved()

    self.topic_text.bind("<<Modified>>", on_text_change)
    self.user_guide_text.bind("<<Modified>>", on_text_change)
    # ... å…¶ä»–æ–‡æœ¬æ¡†

    # Entryç›‘å¬ï¼ˆGenre, Word Numberç­‰ï¼‰
    def on_entry_change(*args):
        self.save_status_indicator.set_unsaved()

    self.genre_var.trace_add("write", on_entry_change)
    self.num_chapters_var.trace_add("write", on_entry_change)
    self.num_volumes_var.trace_add("write", on_entry_change)
    self.word_number_var.trace_add("write", on_entry_change)
    # ... å…¶ä»–å˜é‡
```

**ä¿å­˜æ“ä½œå¢å¼º**:

```python
def save_other_params(self):
    """ä¿å­˜å°è¯´å‚æ•°ï¼ˆå¢å¼ºç‰ˆï¼‰"""
    try:
        # è®¾ç½®ä¸ºä¿å­˜ä¸­çŠ¶æ€
        self.save_status_indicator.set_saving()

        # æ‰§è¡Œä¿å­˜é€»è¾‘
        other_params = {
            "topic": self.topic_text.get("0.0", "end").strip(),
            "genre": self.genre_var.get().strip(),
            # ... å…¶ä»–å‚æ•°
        }

        # ä¿å­˜åˆ° config.json
        self.loaded_config["other_params"] = other_params
        save_config(self.loaded_config)

        # è®¾ç½®ä¸ºå·²ä¿å­˜çŠ¶æ€
        self.save_status_indicator.set_saved()

        messagebox.showinfo("æˆåŠŸ", "å°è¯´å‚æ•°å·²ä¿å­˜ï¼")
        self.safe_log("âœ… å°è¯´å‚æ•°å·²ä¿å­˜")

    except Exception as e:
        # ä¿å­˜å¤±è´¥ï¼Œæ¢å¤æœªä¿å­˜çŠ¶æ€
        self.save_status_indicator.set_unsaved()
        messagebox.showerror("é”™è¯¯", f"ä¿å­˜å¤±è´¥: {str(e)}")
        self.safe_log(f"âŒ ä¿å­˜å¤±è´¥: {str(e)}")
```

#### æ–¹æ¡ˆBï¼šè‡ªåŠ¨ä¿å­˜æé†’ï¼ˆå¯é€‰ï¼‰

åœ¨åˆ‡æ¢æ ‡ç­¾é¡µæˆ–æ‰§è¡Œç”Ÿæˆæ“ä½œæ—¶ï¼Œæ£€æµ‹æœªä¿å­˜çŠ¶æ€å¹¶æé†’ï¼š

```python
def check_unsaved_changes_before_action(self, action_name: str) -> bool:
    """
    åœ¨æ‰§è¡Œé‡è¦æ“ä½œå‰æ£€æŸ¥æœªä¿å­˜çš„ä¿®æ”¹

    Returns:
        bool: True è¡¨ç¤ºå¯ä»¥ç»§ç»­ï¼ŒFalse è¡¨ç¤ºç”¨æˆ·å–æ¶ˆ
    """
    if self.has_unsaved_changes:
        response = messagebox.askyesnocancel(
            "æœªä¿å­˜çš„ä¿®æ”¹",
            f"æ£€æµ‹åˆ°å°è¯´å‚æ•°æœ‰æœªä¿å­˜çš„ä¿®æ”¹ã€‚\n\n"
            f"æ˜¯å¦åœ¨{action_name}å‰ä¿å­˜ï¼Ÿ\n\n"
            f"ç‚¹å‡»"æ˜¯"ä¿å­˜å¹¶ç»§ç»­\n"
            f"ç‚¹å‡»"å¦"ä¸ä¿å­˜å¹¶ç»§ç»­\n"
            f"ç‚¹å‡»"å–æ¶ˆ"è¿”å›ä¿®æ”¹",
            icon='warning'
        )

        if response is True:  # æ˜¯
            self.save_other_params()
            return True
        elif response is False:  # å¦
            return True
        else:  # å–æ¶ˆ
            return False

    return True
```

**è°ƒç”¨ç¤ºä¾‹**:
```python
def generate_chapter_draft_ui(self):
    """ç”Ÿæˆç« èŠ‚è‰ç¨¿ï¼ˆå¢å¼ºç‰ˆï¼‰"""
    # æ£€æŸ¥æœªä¿å­˜çš„ä¿®æ”¹
    if not self.check_unsaved_changes_before_action("ç”Ÿæˆç« èŠ‚"):
        return

    # ç»§ç»­æ‰§è¡Œç”Ÿæˆé€»è¾‘
    # ...
```

---

## ğŸ“Š å®æ–½ä¼˜å…ˆçº§å»ºè®®

| åŠŸèƒ½ | ä¼˜å…ˆçº§ | å¼€å‘é‡ | å½±å“èŒƒå›´ |
|-----|-------|--------|---------|
| **åœºæ™¯1ï¼šç« èŠ‚è¿ç»­æ€§æ ¡éªŒ** | ğŸ”´ é«˜ | ä¸­ | ç« èŠ‚ç”Ÿæˆæµç¨‹ |
| **åœºæ™¯2ï¼šé…ç½®é”å®šæœºåˆ¶** | ğŸ”´ é«˜ | å¤§ | å°è¯´å‚æ•°ç•Œé¢ |
| **åœºæ™¯2ï¼šé…ç½®å˜æ›´æ£€æµ‹** | ğŸŸ¡ ä¸­ | ä¸­ | ä¿å­˜é…ç½®æµç¨‹ |
| **åœºæ™¯3ï¼šä¿å­˜çŠ¶æ€æŒ‡ç¤ºå™¨** | ğŸŸ¢ ä½ | ä¸­ | å°è¯´å‚æ•°ç•Œé¢ |
| **åœºæ™¯3ï¼šè‡ªåŠ¨ä¿å­˜æé†’** | ğŸŸ¢ ä½ | å° | å…¨å±€æ“ä½œæ‹¦æˆª |

---

## ğŸ› ï¸ å®æ–½è®¡åˆ’

### é˜¶æ®µ1ï¼šæ ¸å¿ƒé˜²å‘†ï¼ˆå¿…é¡»ï¼‰

1. âœ… ç« èŠ‚è¿ç»­æ€§æ ¡éªŒï¼ˆæ™ºèƒ½æ£€æµ‹ + æç¤ºï¼‰
2. âœ… é…ç½®é”å®šæœºåˆ¶ï¼ˆç« èŠ‚æ•°/åˆ†å·æ•°é”å®šï¼‰

**é¢„è®¡æ—¶é—´**: 4-6å°æ—¶

### é˜¶æ®µ2ï¼šç”¨æˆ·ä½“éªŒå¢å¼ºï¼ˆæ¨èï¼‰

3. âœ… ä¿å­˜çŠ¶æ€æŒ‡ç¤ºå™¨
4. âœ… é…ç½®å˜æ›´æ£€æµ‹ä¸è­¦å‘Š

**é¢„è®¡æ—¶é—´**: 3-4å°æ—¶

### é˜¶æ®µ3ï¼šé«˜çº§åŠŸèƒ½ï¼ˆå¯é€‰ï¼‰

5. â­• è‡ªåŠ¨ç« èŠ‚å·æ£€æµ‹
6. â­• æœªä¿å­˜ä¿®æ”¹æé†’

**é¢„è®¡æ—¶é—´**: 2-3å°æ—¶

---

## ğŸ“ éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶æ¸…å•

| æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ | éš¾åº¦ |
|-----|---------|------|
| `ui/generation_handlers.py` | æ·»åŠ ç« èŠ‚è¿ç»­æ€§æ ¡éªŒ | â­â­ |
| `ui/novel_params_tab.py` | æ·»åŠ é…ç½®é”å®šUIã€ä¿å­˜çŠ¶æ€æŒ‡ç¤ºå™¨ | â­â­â­ |
| `ui/main_window.py` | é›†æˆæ ¡éªŒé€»è¾‘ã€ä¿®æ”¹ä¿å­˜æµç¨‹ | â­â­ |
| `core/utils/file_utils.py`ï¼ˆæ–°å»ºæˆ–æ‰©å±•ï¼‰ | é€šç”¨æ ¡éªŒå‡½æ•°åº“ | â­ |

---

## â“ è¯·ç¡®è®¤ä»¥ä¸‹é—®é¢˜

1. **åœºæ™¯1ä¼˜å…ˆçº§**: æ˜¯å¦éœ€è¦"è‡ªåŠ¨æ£€æµ‹ä¸‹ä¸€ç« "åŠŸèƒ½ï¼Œè¿˜æ˜¯åªæ ¡éªŒå³å¯ï¼Ÿ
2. **åœºæ™¯2è§£é”æ–¹å¼**: è§£é”é…ç½®æ˜¯å¦éœ€è¦å¯†ç ä¿æŠ¤ï¼Ÿ
3. **åœºæ™¯3ä¿å­˜æé†’**: æ˜¯å¦å¸Œæœ›åœ¨æ¯æ¬¡åˆ‡æ¢æ ‡ç­¾é¡µæ—¶éƒ½æé†’æœªä¿å­˜ï¼Ÿ
4. **å®æ–½é¡ºåº**: æ˜¯å¦æŒ‰ç…§é˜¶æ®µ1â†’é˜¶æ®µ2â†’é˜¶æ®µ3çš„é¡ºåºå®æ–½ï¼Ÿ

---

## ğŸ¨ UIæ•ˆæœé¢„è§ˆï¼ˆæ–‡å­—ç‰ˆï¼‰

### ç« èŠ‚è¿ç»­æ€§æ ¡éªŒå¯¹è¯æ¡†
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš ï¸  ç« èŠ‚è¿ç»­æ€§æ£€æŸ¥å¤±è´¥                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å½“å‰è¦ç”Ÿæˆï¼šç¬¬ 5 ç«                      â”‚
â”‚ å·²ç”Ÿæˆç« èŠ‚ï¼š1, 2                        â”‚
â”‚ ç¼ºå¤±ç« èŠ‚ï¼š3, 4                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å»ºè®®æ“ä½œï¼š                              â”‚
â”‚ 1. å…ˆç”Ÿæˆç¬¬ 3 ç«                         â”‚
â”‚ 2. æˆ–è€…ä¿®æ”¹ç« èŠ‚å·ä¸º 3                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [ å¼ºåˆ¶ç”Ÿæˆ ]  [ è¿”å›ä¿®æ”¹ ]             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### é…ç½®é”å®šçŠ¶æ€
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å°è¯´ç»“æ„:                               â”‚
â”‚ ç« èŠ‚æ•°: [  30  ] ğŸ”’                     â”‚
â”‚ åˆ†å·æ•°: [  3   ] ğŸ”’                     â”‚
â”‚                                         â”‚
â”‚ ğŸ’¡ æç¤ºï¼šå‚æ•°å·²é”å®š                      â”‚
â”‚    å·²ç”Ÿæˆç« èŠ‚ç›®å½•ï¼Œä¿®æ”¹å¯èƒ½å¯¼è‡´ä¸ä¸€è‡´    â”‚
â”‚                                         â”‚
â”‚ [ ğŸ”“ è§£é”é…ç½®ï¼ˆé«˜çº§ï¼‰]                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¿å­˜çŠ¶æ€æŒ‡ç¤ºå™¨
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å°è¯´å‚æ•°         ğŸ”´ å°šæœªä¿å­˜            â”‚
â”‚                  æœ‰æœªä¿å­˜çš„ä¿®æ”¹          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ...                                     â”‚
â”‚                                         â”‚
â”‚ [ ğŸ’¾ ä¿å­˜å°è¯´å‚æ•° ]                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**è¯·æ‚¨ç¡®è®¤ä»¥ä¸Šæ–¹æ¡ˆæ˜¯å¦ç¬¦åˆé¢„æœŸï¼Œæˆ‘å°†æ ¹æ®æ‚¨çš„åé¦ˆè¿›è¡Œä»£ç å®æ–½ï¼** ğŸš€
